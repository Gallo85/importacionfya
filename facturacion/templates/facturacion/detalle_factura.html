{% extends 'core/base.html' %}
{% load humanize %}

{% block content %}
<div class="container mt-5 mb-5">
  <h1 class="text-center text-primary mb-4">üßæ Detalle de Factura #{{ factura.id }}</h1>

  <!-- üîπ Informaci√≥n de la Factura -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-header bg-light">
      <h5 class="mb-0 text-secondary"><i class="bi bi-info-circle"></i> Informaci√≥n General</h5>
    </div>
    <div class="card-body">
      <div class="row mb-2">
        <div class="col-md-6"><strong>Cliente:</strong> {{ factura.cliente }}</div>
        <div class="col-md-6"><strong>Fecha:</strong> {{ factura.fecha|date:"d/m/Y H:i" }}</div>
      </div>
      <div class="row mb-2">
        <div class="col-md-6"><strong>Cotizaci√≥n D√≥lar:</strong> ${{ factura.dolar_venta|floatformat:2|intcomma }}</div>
        <div class="col-md-6"><strong>M√©todo de Pago:</strong> 
          {% if factura.pago_pesos > 0 and factura.pago_dolares > 0 %}
            Mixto (Pesos + D√≥lares)
          {% elif factura.pago_pesos > 0 %}
            Solo en Pesos
          {% elif factura.pago_dolares > 0 %}
            Solo en D√≥lares
          {% else %}
            No especificado
          {% endif %}
        </div>
      </div>
      <div class="row mb-2">
        <div class="col-md-6"><strong>Pago en Pesos:</strong> ${{ factura.pago_pesos|floatformat:2|intcomma }}</div>
        <div class="col-md-6"><strong>Pago en D√≥lares:</strong> USD ${{ factura.pago_dolares|floatformat:2|intcomma }}</div>
      </div>
      {% if factura.observaciones %}
      <div class="row mb-2">
        <div class="col-md-12"><strong>Observaciones:</strong> {{ factura.observaciones }}</div>
      </div>
      {% endif %}
      <div class="row mb-2">
        <div class="col-md-6"><strong>Vuelto:</strong> 
          {% if factura.vuelto > 0 %}
            <span class="text-success">${{ factura.vuelto|floatformat:2|intcomma }}</span>
          {% else %}
            <span class="text-muted">Sin vuelto</span>
          {% endif %}
        </div>
        <div class="col-md-6"><strong>Vuelto Entregado:</strong> 
          {% if factura.vuelto_entregado %}
            ‚úÖ S√≠
          {% else %}
            ‚ùå No
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- üîπ Tabla de Productos -->
  <div class="card shadow-sm border-0">
    <div class="card-header bg-light">
      <h5 class="mb-0 text-secondary"><i class="bi bi-box-seam"></i> Detalle de Productos</h5>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-striped table-bordered mb-0 text-center align-middle">
          <thead class="table-primary">
            <tr>
              <th class="text-center">Producto</th>
              <th class="text-center">Precio Unitario</th>
              <th class="text-center">Cantidad</th>
              <th class="text-center">Subtotal</th>
            </tr>
          </thead>
          <tbody>
            {% for detalle in detalles %}
            <tr>
              <td class="text-center fw-semibold">{{ detalle.nombre_con_imei }}</td>
              <td class="text-center">${{ detalle.precio_unitario|floatformat:2|intcomma }}</td>
              <td class="text-center">{{ detalle.cantidad }}</td>
              <td class="text-center text-primary fw-bold">${{ detalle.subtotal|floatformat:2|intcomma }}</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="4" class="text-center text-muted py-3">No hay productos en esta factura.</td>
            </tr>
            {% endfor %}
          </tbody>
          <tfoot>
            <tr class="table-light fw-bold">
              <td colspan="3" class="text-end">üí∞ Total:</td>
              <td class="text-center text-success">${{ factura.total|floatformat:2|intcomma }}</td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <!-- üîπ Bot√≥n Volver -->
  <div class="text-center mt-4">
    <a href="{% url 'facturacion:listar_facturas' %}" class="btn btn-secondary px-4 py-2">
      üîô Volver a Facturas
    </a>
  </div>
</div>
{% endblock %}
